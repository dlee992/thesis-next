\section{集成化测试工具 \sg }
\sg 工具也是使用 Java 实现的可视化集成工具，同样使用 Apache POI 库来读写 Excel 格式的电子表格。
和\wa 类似，目前只能在 Windows 操作系统下执行。
\sg 的初始核心代码是由张瑞青师兄开发，我们额外添加了两个新技术模块，\cu-OPT\footnote{原\cu 技术的 bug 修复版本} 和 \wa ，并进行了对应的集成编码工作。
相应的工具介绍主页发布在 GitHub Pages 上 \footnote{https://sheetguard.github.io/sguard/}，其中包含了工具源码链接和介绍性的视频链接，发布在 YouTube \footnote{https://www.youtube.com/watch?v=gNPmMvQVf5Q} 和 Bilibili \footnote{https://www.bilibili.com/video/BV1x4411g7do} 网站上。

\sg 工具的完整实现包含约 10,500 行 Java 代码，其中包含约 7,300 行核心代码和约 3,200 行图形界面代码。

\subsection{SGuard 工具架构}
\input{figure/sg/sguard-framework.tex}
如图\ref{figure-sg-framework}所示，可视化集成工具\sg 包含三个核心模块：
\begin{itemize}
    \item \textbf{GUI模块}：该模块主要包含两个功能：用于展示用户界面，和终端用户进行交互；向内部各种缺陷检测技术发起执行请求，并等待结果返回并展示给终端用户。此模块将在后续两个小节进行详细介绍和展示；
    \item \textbf{缺陷检测技术模块}：该模块主要包含两个功能：等待 GUI 模块的唤醒，执行不同的缺陷检测技术；并将检测结果传递给底层数据结构。在具体的实现中，我们将所有技术用一个通用的外包装器包裹起来，简化与其它功能模块的交互接口；
    \item \textbf{底层数据结构模块}：该模块主要包含两个功能：读取文件系统中用户指定的 Excel 文件，将其中包含的多个工作表通过 Apache POI 第三方库，映射到算法内部对应的保存多张二维表和每个单元格的具体信息的数据结构中，如果后续需要将缺陷检测后的结果进行保存，同样利用 Apache POI 库完成相应的文件系统写入功能；将处理好的电子表格原数据传递给缺陷检测技术模块，并等待不同技术的返回结果，并将向相应的检测结果（包含可能的聚类信息和缺陷信息）标注到底层原数据中。
\end{itemize} 

接下来将结合具体的界面设计和使用展示来介绍\sg 。

\subsection{界面设计}
\input{figure/figure11.tex}
% \input{figure/sg/sguard-3.tex}
\input{figure/sg/sguard-4.tex}
\input{figure/sg/sguard-5.tex}
\input{figure/sg/sguard-6.tex}
% \input{figure/sg/sguard-8.tex}
图\ref{figure11} 展示了\sg 使用交互界面来检测电子表格缺陷并展示相应结果的截图。
整个界面包含四大区域：

\begin{itemize}
    \item 上方的文件选取区域包含 Open Excel file（打开 Excel 文件）和Switch to values/formulas（切换到数值/公式形式）两个按钮，中间部分显示当前打开的 Excel 文件路径；
    
    \item 左侧的工作表选择区域列出了当前选定的 Excel 文件的所有工作表；
    
    \item 中间的工作表内容展示区域展示了类似于电子表格软件的核心界面，即以字母标记的列号（A，B，\dots）和以数字标记的行号（1，2，\dots），每个对应的表格位置显示该工作表的具体内容，即公式、数值或文本，目前不能显示除此以外的内容，比如工作表中插入的图，以及不会保留原工作表的排版风格，只显示每个单元格里的具体内容；
    
    \item 右侧的核心操作区域包含如下几块内容：

        \begin{enumerate}
            \item 上方罗列了 \sg 工具内部囊括的所有检测技术，共有 6 个检测技术，分别是 \am\cite{dou2014spreadsheet}，\ca\cite{dou2017cacheck}，\cu\cite{cheung2016custodes}，\cu-OPT\footnote{http://sccpu2.cse.ust.hk/custodes/cc2s.html}，\wa 和 TableCheck\cite{dou2016detecting}。每个技术名称后面标记了对应论文发表的时间或者该技术更新的最新时间；
            
            \item 紧接着向下是 Start analysis 和 Cancel 两个按钮，分别用来开始执行技术对应的代码和取消当前分析过程；
            
            \item 再往下有两个标签，Detective cells 和 Marked clusters，每个运行的技术分别对应标签内部的一个选项；
            
            \item 再往下是 Info 栏，展示一些执行信息以及每个电子表格缺陷检测结果汇总，包含每个技术检测到的单元格类数量和有缺陷的单元格数量；
            
            \item 紧接着是一个 Save to files 按钮，可以用来保存当前选定技术的检测结果到新的 Excel 文件中；
            
            \item 最后是 Logs 栏，用来显示每个完成执行的技术和对应的时间戳。
        \end{enumerate}

\end{itemize}

\subsection{使用展示}
接下来，我们结合一个具体的工作表来展示 \sg 的完整使用流程。

\begin{enumerate}
    \item 我们点击 Open Excel file 按钮，从文件浏览器中选择一个要测试的电子表格，这里我们选择一个电子表格文件illustrative\_example.xls；
    
    \item 如图\ref{figure-sg4}所示，从左侧列出的工作表中，我们选择名为 summary1201 的工作表，对应的单元格内容就自动显示在正中间；
    
    \item 如图\ref{figure-sg4}所示，我们在右侧功能区选择准备使用的电子表格测试技术，这里我们勾选上除 TableCheck 之外的所有技术，并点击 Start analysis 开始执行；
    
    \item 如图\ref{figure-sg5}所示，我们会在 Logs 区域看到各个技术开始和结束的标志，在 Defective cells 选项卡里可以勾选上多个技术，查看对应检测到的缺陷单元格全集，这里我们选择 \wa 技术，可以看到 \wa 检测到了 7 个缺陷单元格，与 Info 区域显示的检测结果保持一致；
    
    \item 如图\ref{figure-sg6}所示，我们在 Marked clusters 选项卡里也可以勾选多个技术，这里我们选择\wa 技术，中间区域显示出\wa 检测到的 7 个单元格类，与 Info 区域显示的检测结果保持一致；
    
    \item 我们点击 Save to files 按钮之后，每个技术的检测结果单独生成一个 Excel 文件，和源文件放在同一个目录下；
    
    % \item 如图\ref{figure-sg8}所示，
    \item 我们打开 illustrave\_example\_WARDER.xls 文件，顾名思义，该文件记录了 \wa 的检测结果，其中标注了和 \sg 工具中显示的相同的单元格类，以及在右上角用注释的方式标注出有公式缺陷的单元格。
\end{enumerate}